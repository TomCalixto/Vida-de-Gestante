<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Contrações</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <h1>Registro de Contrações</h1>

        <!-- Tela de login -->
        <div id="login-screen" class="screen">
            <h2>Login</h2>
            <input type="email" id="email" placeholder="E-mail" required>
            <input type="password" id="password" placeholder="Senha" required>
            <button onclick="login()">Entrar</button>
            <p>Não tem uma conta? <span onclick="showSignup()">Cadastrar-se</span></p>
        </div>

        <!-- Tela de cadastro -->
        <div id="signup-screen" class="screen" style="display:none;">
            <h2>Cadastro</h2>
            <input type="email" id="signup-email" placeholder="E-mail" required>
            <input type="password" id="signup-password" placeholder="Senha" required>
            <button onclick="signup()">Cadastrar</button>
            <p>Já tem uma conta? <span onclick="showLogin()">Entrar</span></p>
        </div>

        <!-- Tela principal com registros de contrações -->
        <div id="records-screen" class="screen" style="display:none;">
            <h2>Histórico de Contrações</h2>
            <button onclick="startContraction()">Iniciar Contração</button>
            <button onclick="endContraction()">Finalizar Contração</button>
            <ul id="contractions-list"></ul>
        </div>
    </div>

    <script type="module">
        // Importando os módulos do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Configuração do Firebase
const firebaseConfig = {
    apiKey: "AIzaSyDKEF-5qgGEm_e3JtIG9r4AwjH3x5s6o48",
    authDomain: "vida-de-gestante.firebaseapp.com",
    projectId: "vida-de-gestante",
    storageBucket: "vida-de-gestante.firebasestorage.app",
    messagingSenderId: "442794310384",
    appId: "1:442794310384:web:b9de65e5d28508cf386035",
    measurementId: "G-J3LTZLML9K"
  };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Função de login
        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Login bem-sucedido:", user);
                    showRecordsScreen();
                })
                .catch((error) => {
                    console.error("Erro de login:", error.message);
                });
        }

        // Função de cadastro
        function signup() {
            const email = document.getElementById("signup-email").value;
            const password = document.getElementById("signup-password").value;

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Cadastro bem-sucedido:", user);
                    showRecordsScreen();
                })
                .catch((error) => {
                    console.error("Erro de cadastro:", error.message);
                });
        }

        // Função para mostrar a tela de login
        function showLogin() {
            document.getElementById("login-screen").style.display = "block";
            document.getElementById("signup-screen").style.display = "none";
        }

        // Função para mostrar a tela de cadastro
        function showSignup() {
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("signup-screen").style.display = "block";
        }

        // Função para mostrar a tela de registros de contrações
        function showRecordsScreen() {
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("signup-screen").style.display = "none";
            document.getElementById("records-screen").style.display = "block";
        }

        // Histórico de contrações
        let contractions = [];
        let startTime = null;

        function startContraction() {
            if (startTime) {
                alert("A contração já foi iniciada!");
                return;
            }
            startTime = new Date();
            alert("Contração iniciada!");
        }

        function endContraction() {
            if (!startTime) {
                alert("Nenhuma contração em andamento.");
                return;
            }
            const endTime = new Date();
            const duration = (endTime - startTime) / 1000; // em segundos

            const newContraction = { startTime, endTime, duration };
            contractions.push(newContraction); // Adiciona a contração ao histórico

            console.log("Nova contração registrada:", newContraction);
            saveContractions();
            displayContractions();

            // Salvar no Firestore
            saveToFirestore(newContraction);

            startTime = null; // Reseta o início da contração
        }

        function displayContractions() {
            const list = document.getElementById("contractions-list");
            list.innerHTML = "";

            contractions.forEach((contraction, index) => {
                const li = document.createElement("li");
                li.textContent = `Contração ${index + 1}: Duração: ${contraction.duration.toFixed(3)} segundos`;
                list.appendChild(li);
            });
        }

        function saveContractions() {
            localStorage.setItem("contractions", JSON.stringify(contractions));
        }

        // Função para salvar contrações no Firestore
        async function saveToFirestore(contraction) {
            const user = auth.currentUser;
            if (user) {
                const docRef = doc(db, "contractions", user.uid);
                await setDoc(docRef, {
                    contractions: firebase.firestore.FieldValue.arrayUnion(contraction)
                });
                console.log("Contração salva no Firestore.");
            }
        }

        // Ouvir mudanças no estado de autenticação
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Usuário autenticado:", user);
                showRecordsScreen();
            } else {
                console.log("Usuário não autenticado.");
                showLogin();
            }
        });

    </script>
</body>
</html>
