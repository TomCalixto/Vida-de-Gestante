<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Contrações</title>
    <link rel="stylesheet" href="styles.css"> <!-- Verifique se o arquivo está no mesmo diretório -->
</head>
<body>
    <div id="app">
        <h1>Registro de Contrações</h1>
        
        <!-- Tela de Login -->
        <div id="login">
            <input type="email" id="email" placeholder="Digite seu email">
            <input type="password" id="password" placeholder="Digite sua senha">
            <button onclick="login()">Entrar</button>
        </div>

        <!-- Tela de Registros de Contrações -->
        <div id="register" style="display: none;">
            <div id="controls">
                <button onclick="startContraction()">Iniciar Contração</button>
                <button onclick="endContraction()">Finalizar Contração</button>
            </div>
            <h2>Histórico de Contrações</h2>
            <ul id="contractions-list"></ul>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        // Importação das bibliotecas Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // Inicializando o Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();

        let contractions = [];
        let startTime = null;

        // Função de Login
        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            
            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    alert("Login realizado com sucesso!");
                    document.getElementById("login").style.display = "none";
                    document.getElementById("register").style.display = "block";
                })
                .catch((error) => {
                    alert(error.message);
                });
        }

        // Função de iniciar contração
        function startContraction() {
            if (startTime) {
                alert("A contração já foi iniciada!");
                return;
            }
            startTime = new Date();
            alert("Contração iniciada!");
        }

        // Função de finalizar contração
        function endContraction() {
            if (!startTime) {
                alert("Nenhuma contração em andamento.");
                return;
            }
            const endTime = new Date();
            const duration = (endTime - startTime) / 1000; // em segundos

            const newContraction = { startTime, endTime, duration };
            contractions.push(newContraction); // Adiciona a contração ao histórico
            saveContractions();
            displayContractions();

            startTime = null; // Reseta o início da contração
        }

        // Exibir os registros de contração
        function displayContractions() {
            const list = document.getElementById("contractions-list");
            list.innerHTML = "";

            if (contractions.length === 0) {
                return;
            }

            contractions.forEach((contraction, index) => {
                const li = document.createElement("li");
                const startFormatted = formatDate(contraction.startTime);
                const endFormatted = formatDate(contraction.endTime);

                li.innerHTML = `Contração ${index + 1}: Início: ${startFormatted}, Fim: ${endFormatted}, Duração: ${contraction.duration.toFixed(3)} segundos`;
                list.appendChild(li);
            });
        }

        // Salvar os dados das contrações no Firebase
        function saveContractions() {
            const user = auth.currentUser;
            if (user) {
                setDoc(doc(db, "users", user.uid), {
                    contractions: contractions
                }).then(() => {
                    console.log("Contrações salvas no Firestore");
                }).catch((error) => {
                    console.log("Erro ao salvar contrações:", error);
                });
            }
        }

        // Formatar data para exibição
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }
    </script>
</body>
</html>
